-- [[ 1. CONFIGURATION & STATE ]] --
local CFG = {
    Multiplier = 1.25,
    ClaimPos = Vector3.new(-48, 12, -128),
    Rarities = {"OG", "God", "Secret"},
    Variants = {"Rainbow", "Galaxy", "Hacker"}
}

local player = game.Players.LocalPlayer
local RunService = game:GetService("RunService")
local Toggles = {TPWalk = false, Aura = false}

-- [[ 2. UI CONSTRUCTOR (CRASH-PROOF) ]] --
local function BuildUI()
    local sg = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
    sg.Name = "Nexus_V34"
    sg.ResetOnSpawn = false

    local main = Instance.new("Frame", sg)
    main.Size = UDim2.new(0, 200, 0, 250)
    main.Position = UDim2.new(0.5, -100, 0.3, 0)
    main.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
    main.BorderSizePixel = 0
    main.Active = true
    main.Draggable = true
    Instance.new("UICorner", main)

    local head = Instance.new("TextLabel", main)
    head.Size = UDim2.new(1, 0, 0, 30)
    head.BackgroundColor3 = Color3.fromRGB(120, 0, 255)
    head.Text = "NEXUS V34 | ELITE"
    head.TextColor3 = Color3.new(1, 1, 1)
    head.Font = Enum.Font.GothamBold
    Instance.new("UICorner", head)

    local scroll = Instance.new("ScrollingFrame", main)
    scroll.Size = UDim2.new(0, 160, 1, 0)
    scroll.Position = UDim2.new(1, 5, 0, 0)
    scroll.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
    scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
    scroll.ScrollBarThickness = 2
    local list = Instance.new("UIListLayout", scroll)
    list.Padding = UDim.new(0, 5)

    return main, scroll, list
end

local Main, Scroll, ScrollList = BuildUI()

-- [[ 3. DYNAMIC TPWALK LOGIC ]] --
-- Logic: Uses Heartbeat to move you in small "blinks" at (CurrentSpeed * 1.25)
local function DoTPWalk()
    RunService.Heartbeat:Connect(function(dt)
        if Toggles.TPWalk and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = player.Character.HumanoidRootPart
            local hum = player.Character:FindFirstChild("Humanoid")
            if not hum then return end

            local currentSpeed = hum.WalkSpeed > 0 and hum.WalkSpeed or 30
            local targetSpeed = currentSpeed * CFG.Multiplier
            
            local dist = (CFG.ClaimPos - hrp.Position).Magnitude
            if dist > 2 then
                local dir = (CFG.ClaimPos - hrp.Position).Unit
                hrp.CFrame = hrp.CFrame + (dir * targetSpeed * dt)
            else
                Toggles.TPWalk = false
            end
        end
    end)
end

-- [[ 4. ELITE SCANNER (PATH-OPTIMIZED) ]] --
local function UpdateList()
    for _, v in pairs(Scroll:GetChildren()) do if v:IsA("TextButton") then v:Destroy() end end
    local folder = workspace:FindFirstChild("Brainrots")
    if not folder then return end

    for _, br in pairs(folder:GetChildren()) do
        pcall(function()
            local frame = br.Mesh.InfoGui.Frame
            local r, v, c = frame.CharRarity.Text, frame.CharVariant.Text, frame.Cooldown.TextLabel.Text
            
            local isElite = false
            for _, tar in pairs(CFG.Rarities) do if r:find(tar) then isElite = true end end
            for _, tar in pairs(CFG.Variants) do if v:find(tar) then isElite = true end end

            if isElite then
                local btn = Instance.new("TextButton", Scroll)
                btn.Size = UDim2.new(1, -10, 0, 40)
                btn.Text = v.." "..r.."\n"..c
                btn.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
                btn.TextColor3 = Color3.fromRGB(0, 255, 200)
                btn.Font = Enum.Font.Gotham
                btn.TextSize = 8
                Instance.new("UICorner", btn)
                btn.MouseButton1Click:Connect(function()
                    player.Character.HumanoidRootPart.CFrame = br:GetPivot()
                end)
            end
        end)
    end
    Scroll.CanvasSize = UDim2.new(0, 0, 0, ScrollList.AbsoluteContentSize.Y + 10)
end

-- [[ 5. BUTTON CONTROLS ]] --
local function NewBtn(txt, y, toggleKey)
    local b = Instance.new("TextButton", Main)
    b.Size = UDim2.new(0.9, 0, 0, 40)
    b.Position = UDim2.new(0.05, 0, 0, y)
    b.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    b.Text = txt .. ": OFF"
    b.TextColor3 = Color3.new(1, 1, 1)
    b.Font = Enum.Font.GothamBold
    Instance.new("UICorner", b)
    
    b.MouseButton1Click:Connect(function()
        Toggles[toggleKey] = not Toggles[toggleKey]
        b.Text = txt .. (Toggles[toggleKey] and ": ON" or ": OFF")
        b.BackgroundColor3 = Toggles[toggleKey] and Color3.fromRGB(150, 0, 255) or Color3.fromRGB(30, 30, 35)
    end)
end

NewBtn("TPWALK CLAIM", 40, "TPWalk")
NewBtn("MASS AURA", 90, "Aura")

local Ref = Instance.new("TextButton", Main)
Ref.Size = UDim2.new(0.9, 0, 0, 40)
Ref.Position = UDim2.new(0.05, 0, 0, 140)
Ref.Text = "REFRESH ELITES"
Ref.BackgroundColor3 = Color3.fromRGB(0, 180, 100)
Ref.Font = Enum.Font.GothamBold
Instance.new("UICorner", Ref)
Ref.MouseButton1Click:Connect(UpdateList)

-- [[ 6. EXECUTION ]] --
DoTPWalk() -- Initialize the movement listener

task.spawn(function()
    local remote = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("DamageBlockEvent")
    while task.wait(1/7) do
        if Toggles.Aura then
            pcall(function()
                if workspace:FindFirstChild("HeartbreakerSammyRig") then remote:FireServer(workspace.HeartbreakerSammyRig) end
                local lbs = workspace:FindFirstChild("LuckyBlocks")
                if lbs then for _, b in pairs(lbs:GetChildren()) do remote:FireServer(b) end end
            end)
        end
    end
end)

task.delay(1, UpdateList)
