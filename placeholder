-- [[ SETTINGS ]] --
local SETTINGS = {
    TPWalkSpeed = 20, -- 1.25x of 16
    ClaimPos = Vector3.new(-48, 12, -128),
    ValidRarities = {"OG", "God", "Secret"},
    ValidVariants = {"Rainbow", "Galaxy", "Hacker"}
}

local RunService = game:GetService("RunService")
local player = game.Players.LocalPlayer
local PlayerGui = player:FindFirstChild("PlayerGui")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local Toggles = {TPWalkClaim = false, EliteAura = false}
local CurrentTPWalk = nil

-- 1. UI ENGINE (RE-BUILT FOR MOBILE STABILITY)
local ScreenGui = Instance.new("ScreenGui", PlayerGui)
ScreenGui.ResetOnSpawn = false

local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0, 200, 0, 240)
Main.Position = UDim2.new(0.5, -100, 0.2, 0)
Main.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
Main.Active = true
Main.Draggable = true -- Mobile optimization
Instance.new("UICorner", Main).CornerRadius = BoxHandleAdornment.new().Radius

local Header = Instance.new("Frame", Main)
Header.Size = UDim2.new(1, 0, 0, 30)
Header.BackgroundColor3 = Color3.fromRGB(100, 0, 255)
Instance.new("UICorner", Header)

local Title = Instance.new("TextLabel", Header)
Title.Size = UDim2.new(1, 0, 1, 0)
Title.Text = "NEXUS V32 | ELITE"
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 12
Title.BackgroundTransparency = 1

local ListScroll = Instance.new("ScrollingFrame", Main)
ListScroll.Size = UDim2.new(0, 150, 1, 0)
ListScroll.Position = UDim2.new(1, 5, 0, 0)
ListScroll.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
ListScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
ListScroll.ScrollBarThickness = 2
Instance.new("UIListLayout", ListScroll).Padding = UDim.new(0, 3)

-- 2. OPTIMIZED FUNCTIONS
local function tpWalkTo(targetPos)
    if CurrentTPWalk then CurrentTPWalk:Disconnect() end
    Toggles.TPWalkClaim = true
    
    CurrentTPWalk = RunService.Heartbeat:Connect(function(delta)
        local char = player.Character
        local hrp = char and char:FindFirstChild("HumanoidRootPart")
        
        if hrp and Toggles.TPWalkClaim then
            local dist = (targetPos - hrp.Position).Magnitude
            if dist > 2 then
                local moveDir = (targetPos - hrp.Position).Unit
                hrp.CFrame = hrp.CFrame + (moveDir * SETTINGS.TPWalkSpeed * delta)
            else
                Toggles.TPWalkClaim = false
                CurrentTPWalk:Disconnect()
            end
        else
            CurrentTPWalk:Disconnect()
        end
    end)
end

-- Elite Brainrot Scanner (Optimized)
local function refreshEliteList()
    for _, item in pairs(ListScroll:GetChildren()) do
        if item:IsA("TextButton") then item:Destroy() end
    end
    
    local folder = workspace:FindFirstChild("Brainrots")
    if not folder then return end
    
    for _, br in pairs(folder:GetChildren()) do
        -- pcall prevents "nil" errors from stopping the script
        pcall(function()
            local frame = br.Mesh.InfoGui.Frame
            local r = frame.CharRarity.Text
            local v = frame.CharVariant.Text
            local c = frame.Cooldown.TextLabel.Text
            
            local isElite = false
            for _, val in pairs(SETTINGS.ValidRarities) do if r:find(val) then isElite = true end end
            for _, val in pairs(SETTINGS.ValidVariants) do if v:find(val) then isElite = true end end
            
            if isElite then
                local b = Instance.new("TextButton", ListScroll)
                b.Size = UDim2.new(1, -5, 0, 35)
                b.Text = v .. " " .. r .. "\n" .. c
                b.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
                b.TextColor3 = Color3.new(1, 1, 1)
                b.Font = Enum.Font.Gotham
                b.TextSize = 8
                Instance.new("UICorner", b)
                
                b.MouseButton1Click:Connect(function()
                    player.Character.HumanoidRootPart.CFrame = br:GetPivot()
                end)
            end
        end)
    end
end

-- 3. BUTTON CREATION (FIXED LOGIC)
local function makeToggle(name, yPos, toggleKey)
    local btn = Instance.new("TextButton", Main)
    btn.Size = UDim2.new(0.9, 0, 0, 35)
    btn.Position = UDim2.new(0.05, 0, 0, yPos)
    btn.Text = name .. ": OFF"
    btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.GothamBold
    Instance.new("UICorner", btn)
    
    btn.MouseButton1Click:Connect(function()
        Toggles[toggleKey] = not Toggles[toggleKey]
        btn.Text = name .. (Toggles[toggleKey] and ": ON" or ": OFF")
        btn.BackgroundColor3 = Toggles[toggleKey] and Color3.fromRGB(120, 0, 255) or Color3.fromRGB(30, 30, 30)
        
        -- Special trigger for TPWalk
        if toggleKey == "TPWalkClaim" and Toggles.TPWalkClaim then
            tpWalkTo(SETTINGS.ClaimPos)
        end
    end)
end

makeToggle("TPWALK TO CLAIM", 40, "TPWalkClaim")
makeToggle("MASS AURA", 85, "EliteAura")

local RefBtn = Instance.new("TextButton", Main)
RefBtn.Size = UDim2.new(0.9, 0, 0, 35)
RefBtn.Position = UDim2.new(0.05, 0, 0, 130)
RefBtn.Text = "REFRESH ELITES"
RefBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 100)
RefBtn.TextColor3 = Color3.new(1, 1, 1)
RefBtn.Font = Enum.Font.GothamBold
Instance.new("UICorner", RefBtn)
RefBtn.MouseButton1Click:Connect(refreshEliteList)

-- 4. COMBAT LOOP (7 Hits Per Second)
task.spawn(function()
    local Remote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("DamageBlockEvent")
    while true do
        task.wait(1/7)
        if Toggles.EliteAura then
            -- Kill Sammy
            local sammy = workspace:FindFirstChild("HeartbreakerSammyRig")
            if sammy then Remote:FireServer(sammy) end
            
            -- Clear Lucky Blocks
            local lb = workspace:FindFirstChild("LuckyBlocks")
            if lb then
                for _, block in pairs(lb:GetChildren()) do Remote:FireServer(block) end
            end
        end
    end
end)

-- Initial scan
task.delay(1, refreshEliteList)
